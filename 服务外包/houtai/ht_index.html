<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>会议室管理中心</title>
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="shortcut icon" href="favicon_16.ico"/>
  <!-- <link rel="bookmark" href="favicon_16.ico"/> -->

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
  <!-- Fontastic Custom icon font-->

  <link rel="stylesheet" href="layui/css/layui.css"  media="all">
  <script src="layui/layui.js" charset="utf-8" type="text/javascript"></script>
  <link rel="stylesheet" href="dist/css/me.css">
  <link rel="stylesheet" href="dist/css/site.min.css">
  <script type="text/javascript" src="dist/js/site.min.js"></script>
  <script src="dist/js/jquery.cookie.js"></script>
  <script src="dist/js/vue.min.js"></script>
  <script src="dist/js/jquery-3.3.1.min.js"></script>
</head>
<body>
<!--nav 顶部导航栏-->
<div class="headerpage"></div>
<!--header-->

<div class="container-fluid">
  <!--documents内容-->
  <div class="row row-offcanvas row-offcanvas-left">
    <!--内容左边导航-->
    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" role="navigation">
      <div class="leftpage"></div>
    </div>

    <!--右边内容-->
    <div class="midpage">
    </div>
  </div>
</div>


<!--申请人信息弹出-->
<div id="user_view" class="me_none"></div>
<script type="text/html" id="user_show">
  <ul style="margin-left: 45px;" id="show_user_info" >
    {{#  if(d.data != null){ }}
    <li>
      ID：<span>{{d.data.id}}</span>
    </li>
    <li>用户名：<span>{{d.data.name}}</span></li>
    <li>手机号：<span>{{d.data.phone}}</span></li>
    <li>邮箱：<span>{{d.data.email}}</span></li>
    <li>公司：<span>{{d.data.company.name}}</span></li>
    <li>
      权限：
      {{#  if(d.data.role == 1){ }}
      <span>普通用户</span>
      {{#  } else if(d.data.role == 2) { }}
      <span>HR</span>
      {{#  } else if(d.data.role == 3) { }}
      <span>后勤</span>
      {{#  } else if(d.data.role == 4) { }}
      <span>管理员</span>
      {{#  } }}
    </li>
    {{#  }else { }}
    <li>无</li>
    {{# }}}
  </ul>
</script>

<script type="text/html" id="tstatus"><!--公司-->
{{#  if(d.status == 0){ }}
<p>未安排</p>
{{#  }else if(d.status==1) { }}
<p>安排</p>
{{# } else if(d.status==2) { }}
<p>进行中</p>
{{# } else if(d.status==3) { }}
<p>结束</p>
{{#  } }}
</script>
<script type="text/html" id="tuse">
  {{#
    var time = function(){
      var start = d.beginTime.split(':')[0]+':'+d.beginTime.split(':')[1];
      var end = d.endTime.split(" ")[1];

      return start+'-'+end.split(":")[0]+':'+end.split(":")[1];
    };
  }}
  {{time()}}
</script>

<script>
    $(".headerpage").load("./page/header.html");

    var vm = new Vue({
      el: '#main_content',
      data:{
          notices : [],
          applays: [
              {
                  "id": '',
                  "workerId": '',
                  "topic": "",
                  "intro": "",
                  "documentList": '',
                  "roomId": '',
                  "attendance": '',
                  "beginTime": "",
                  "endTime": "",
                  "status": '',
                  "applyTime": "",
                  "applyUpdateTime": "",
                  "price": '',
                  "flexible": ''
              }
          ],

          others: ""
      },
      methods:{
          agree(){

          },
          refuse(){

          },
          getNotice(){

          },
          getMe(){
              var tdata={
                  userId: '6'
              };
              $.ajax({
                  type: "POST"
                  ,url:"http://lsudjh.top:8081/meetingApply/listByAttendWorker"
                  ,contentType: 'application/json;charset=utf-8'
                  ,data: JSON.stringify(tdata)
                  ,dataType: "json"
                  ,success:function(result){
                      console.log(result);
                  }
              });
          },
          getApply(){
              var tdata={
                  "status": 0,
                  "order": "apply_time desc"
              };
              $.ajax({
                  type: "POST"
                  ,url:"http://lsudjh.top:8081/meetingApply/listEntity"
                  ,contentType: 'application/json;charset=utf-8'
                  ,data: JSON.stringify(tdata)
                  ,dataType: "json"
                  ,success:function(result){
                      console.log(result.data.data);
                      var odata = result.data.data;
                      for(var i=0; i<odata.length;i++){
                          var d = {
                              "id" : odata[i].workerId
                          };
                          $.ajax({
                              type: 'POST'
                              ,url: "http://lsudjh.top:8081/user/get"
                              ,contentType: 'application/json;charset=utf-8'
                              ,data: JSON.stringify(d)
                              ,dataType: 'json'
                              ,success:function (result) {
                                  // console.log(result);
                                  // var name = result.data.name;
                                  // odata[i].workerId = name;
                                  // console.log(odata);
                              }

                          })
                      }

                      vm.applays = result.data.data;
                  }
                  ,error: function (message) {
                      alert(message);
                  }
              });
          },
          getAttendance(){

          }
      },
      created: function () {
          // this.getNotice();
          // this.getApply();
          // this.getAttendance();
          this.getMe();
      }
  });

    function show_people(id){
        var data={ id: id};
        $.ajax({
            url: 'http://lsudjh.top:8081/user/get',
            type: 'post',
            data: JSON.stringify(data) ,
            contentType: 'application/json;charset=utf-8',
            dataType: 'json',
            success: function (result) {
                console.log(result);
                if(result.code==0){
                    layui.use('laytpl', function() {
                        var laytpl = layui.laytpl;
                        var tpldata = result;
                        var getTpl = user_show.innerHTML, view = document.getElementById('user_view');
                        laytpl(getTpl).render(tpldata, function (html) {
                            view.innerHTML = html;
                        });
                        layer.open({
                            type: 1
                            , title: ['发起人信息查看', 'font-size:18px;']
                            , area: ['300px', '360px']
                            , id: 'show_people_detail' //设定一个id，防止重复弹出
                            , btn: ['确定']
                            , btnAlign: 'c'
                            , moveType: 1 //拖拽模式，0或者1
                            , content: $('#user_view')
                        });
                    });
                } else {
                    alert('系统错误，请稍后再试');
                }
            }
        });

    }
  layui.use('table', function(){
      var table = layui.table;
      table.render({
          elem: '#mz_shenhe_table'     //未审核
          ,url:'http://lsudjh.top:8081/meetingApply/listEntity'
          ,method: 'post'
          ,contentType: 'application/json'
          ,cols: [[
              {field:'topic', title:'会议主题',width:120, unresize: true}
              ,{field:'workerId',title:'申请人', width: 72,
              templet: '<div><a class="layui-table-link" onclick=show_people("{{d.workerId}}")>查看</a></div>'}
              ,{field:'useTime', title:'申请时间段', width:182, sort: true, unresize: true,
                  templet:'#tuse'}
              ,{field:'status', title:'状态',templet: '#tstatus'}
          ]]
          ,page: false
          ,where: {size:6, page:1,order :'id asc'}
          ,parseData: function(res){ //res 即为原始返回的数据
              // console.log(res);
              return {
                  "code": res.code, //解析接口状态
                  "msg": res.message, //解析提示文本
                  "count": res.data.total, //解析数据长度
                  "data": res.data.data //解析数据列表
              };
          }
      });
  });
</script>
</body>
</html>
