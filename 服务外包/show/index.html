<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!--<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">-->
    <!--<script type="text/javascript" src="js/bootstrap.min.js"></script>-->
    <script src="js/jquery-3.3.1.js" type="text/javascript"></script>
    <link type="text/css" rel="stylesheet" href="css/show.css">
    <!--<script src="js/show.js" type="text/javascript"></script>-->
    <script type="" src="js/vue.min.js"></script>
    <title>主界面</title>
</head>
<body>
<div id="app">
    <div class="header">
        <div class="fl">
            <img src="images/logoimg.png" class="logo fl">
            <h5 class="fl logo_title">会议室预约系统</h5>
        </div>
        <div class="fr">
            <div class="fl show_time">
                <span class="calendar fl">&#xe72d;</span>
                <p class="fl" id="time"></p>
            </div>
            <img src="images/meetingRoomQR.png" class="ma fr">
        </div>
    </div>
    <div class="content">
        <div class="meet_name">
            <span class="local">&#xe64d;</span>一楼208会议室
        </div>
        <div class="meet_content">
            <table border="1">
                <tr class="meet_table_top center">
                    <th>当前会议</th>
                    <th>时间</th>
                    <th>主题</th>
                    <th>组织人</th>
                </tr>
                <tr>
                    <td rowspan="4" class="center">无</td>
                    <td>10:00-11:00</td>
                    <td>销售讨论会</td>
                    <td>销售部</td>
                </tr>
                <tr>
                    <td>12:00-13:00</td>
                    <td>销售讨论会</td>
                    <td>销售部</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div>
    </div>
    <div class="footer">
        <p class="center company">***股份有限公司所有</p>
    </div>
</div>

<script>
    function timeStampString(time){
        var datetime = new Date();
        datetime.setTime(time);
        var year = datetime.getFullYear();
        var month = datetime.getMonth() + 1 < 10 ? "0" + (datetime.getMonth() + 1) : datetime.getMonth() + 1;
        var date = datetime.getDate() < 10 ? "0" + datetime.getDate() : datetime.getDate();
        var hour = datetime.getHours()< 10 ? "0" + datetime.getHours() : datetime.getHours();
        var minute = datetime.getMinutes()< 10 ? "0" + datetime.getMinutes() : datetime.getMinutes();
        var second = datetime.getSeconds()< 10 ? "0" + datetime.getSeconds() : datetime.getSeconds();
        return year + "-" + month + "-" + date+" "+hour+":"+minute+":"+second;
    }
    window.onload=function () {
        setInterval(showTime,1000);
    };
    function showTime() {
        // console.log(1);
        var today=new Date();
        var tyear = today.getFullYear();
        var tmonth = today.getMonth()+1;
        var tday = today.getDate();
        var tweek;
        switch (today.getDay()) {
            case 1: tweek="星期一";break;
            case 2: tweek="星期二";break;
            case 3: tweek="星期三";break;
            case 4: tweek="星期四";break;
            case 5: tweek="星期五";break;
            case 6: tweek="星期六";break;
            case 0: tweek="星期日";break;
        }
        var thour=today.getHours();
        var tminute=today.getMinutes();
        var tseconds = today.getSeconds();
        if(thour<10)
            thour = '0'+thour;
        if(tseconds<10)
            tseconds = '0'+tseconds;
        if(tminute<10)
            tminute = '0'+tminute;
        document.getElementById('time').innerText = tyear+"年"+tmonth+"月"+ tday + '日 \xa0\xa0\xa0\xa0' +
            tweek + '\xa0\xa0\xa0\xa0'+ thour + ":" + tminute + ":" + tseconds;
        // console.log(tyear,tday,tmonth,tweek,thour,tseconds,tminute);
    }

    var vm = new Vue({
        el: '#app',
        data: {
            roomId: '',
            meetInfo: [],

        },
        methods: {
            getMeetsInfo(){
                var data ={
                    roomID: 7,
                    status: 0,
                    beginTime: timeStampString(new Date().getTime())+','
                };
                // console.log(data);
                $.ajax({
                    url:"http://lsudjh.top:8081/meetingApply/listEntity",
                    type:"POST",
                    data:JSON.stringify(data),
                    contentType:"application/json",  //缺失会出现URL编码，无法转成json对象
                    success:function(result){ //所有错误信息都如result.message有关
                        console.log(result);
                        var tdata = result.data.data;
                        if(result.code==0){
                            for(var i =0;i<tdata.length;i++){
                                tdata[i].beginTime = tdata[i].beginTime.split(' ')[1].split(':')[0]+':'+
                                    tdata[i].beginTime.split(' ')[1].split(':')[1]+'-'+
                                    tdata[i].endTime.split(' ')[1].split(':')[0]+':'+
                                    tdata[i].endTime.split(' ')[1].split(':')[1];
                                // tdata[i].beginTime = tdata[i].beginTime.split(':')[0]+':'+ tdata[i].beginTime.split(':')[1];
                                // tdata[i].endTime = tdata[i].endTime.split(' ')[1].split(':')[0]+':'+
                                //     tdata[i].endTime.split(' ')[1].split(':')[1];
                            }
                            getUserName(0,tdata.length);
                            function getUserName(j,length) {
                                var udata={
                                    id: tdata[j].workerId
                                }
                                $.ajax({
                                    url:"http://lsudjh.top:8081/user/get",
                                    type:"POST",
                                    data:JSON.stringify(udata),
                                    contentType:"application/json",  //缺失会出现URL编码，无法转成json对象
                                    success:function(result){ //所有错误信息都如result.message有关
                                        // console.log(result.data);
                                        if(result.data!=null){
                                            tdata[j].flexible = result.data.name;
                                        } else{
                                            tdata[j].flexible = '无';
                                        }

                                        if(++j < length) {
                                            getUserName(j, length);
                                        }
                                    }
                                });
                            }
                            console.log(tdata);
                            vm.meetInfo = tdata;
                        }
                    }
                });
            },
        }
    })
    vm.getMeetsInfo();


</script>
</body>
</html>